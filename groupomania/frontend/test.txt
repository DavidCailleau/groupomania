let url = 'http://localhost:3000/'
let id = localStorage.getItem("userId")



function createWrittenPost () {

   
                fetch(url + 'api/message', {
                  method:'POST',
                  headers: {'Content-Type': 'application/json',
                             'Authorization': 'Bearer ' + localStorage.getItem('token') },
                  body:JSON.stringify({
                    userId:localStorage.getItem('userId'),
                    title:document.getElementById('title-message').value,
                    message:document.getElementById('new-message').value,
                    /*imageUrl:document.getElementById('image-network').value,*/
                    creatorFirstname: localStorage.getItem("firstname"),
                    creatorLastname:localStorage.getItem("lastname"),
                  })           
                }).then(
                  function (response){
                    return response.json()
                  } 
                ).catch(
                    (error)=>{
                        console.log(error)
                    })}
           


  
  let submitWrittenPost = document.getElementById('form-network');
  submitWrittenPost.addEventListener('submit',($event)=>{
    $event.preventDefault();
    createWrittenPost()})



    /////////////////////////////////////////

    const Message = require('../models/message');
const fs = require("fs");

exports.createMessage= (req,res,next)=>{
    
    let date = new Date
    let currentDate = date.getDate() + '/' + (date.getMonth()+1) + '/' + date.getFullYear()  + ' at ' +  date.getHours() + ':' + ('0'+date.getMinutes()).slice(-2);
   if (req.file){ 
    const message = new Message({
        userId:req.body.userId,
        title:req.body.title,
        message:req.body.message,
        imageUrl:`${req.protocol}://${req.get('host')}/images/${req.file.filename}`,
        date: currentDate,
        creatorFirstname:req.body.creatorFirstname,
        creatorLastname:req.body.creatorLastname,
    });}else{    
        const message = new Message({
        userId:req.body.userId,
        title:req.body.title,
        message:req.body.message,
        imageUrl:`${req.protocol}://${req.get('host')}/images/${req.file.filename}`,
        date: currentDate,
        creatorFirstname:req.body.creatorFirstname,
        creatorLastname:req.body.creatorLastname,})}
   

    message.save().then(
        ()=>{
            res.status(200).json({
                message:'Message créé'
            })
        }
    ).catch(
        (error)=>{
            res.status(400).json({
                error:error
            });
        }
    );
};

exports.getAllMessages =(req,res,next)=>{
    Message.find().then(
        (messages)=>{
            res.status(200).json(messages)
        }
    ).catch(
        (error)=>{
            res.status(400).json(error)
        }
    )
}

////////////////////////////

let url = 'http://localhost:3000/'
let id = localStorage.getItem("userId")
let emailContact = localStorage.getItem("email")

//////// AFFICHAGE ARTICLES /////////


function getAllArticles () {
    

    fetch(url + 'api/article', {
        method:'GET',
        headers: {'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + localStorage.getItem('token') },

    }).then(
        function (response){
            return response.json
        }   
    ).catch(
            (error)=>{
                console.log(error)
            }
        )
}

function articles() {
    
    const articles =  getAllArticles();
  
    /* Lien avec la page index HTML */
  
    let listeArticle = document.getElementById("liste-article");
  
    /* création de la structure index HTML */
  
    articles.forEach((article) => {
      let articleContenant = document.createElement("a");
      let articleIllustration = document.createElement("div");
      let articleElement = document.createElement("div");
      let articlePhoto = document.createElement("img");
      let articleNom = document.createElement("h3");
      let articlePrix = document.createElement("p");
      let articleMail = document.createElement("p");
  
      /*Ajout des attributs au balise index HTML */
      articleContenant.setAttribute("href", "article.html?id=" + article._id);
      articleIllustration.setAttribute("class", "article_illustration");
      articlePhoto.setAttribute("src", article.imageUrl);
      articlePhoto.setAttribute("alt", "Photo de l'article");
      articleElement.setAttribute("class", "article_element");
      articleNom.setAttribute("class", "article_nom");
      articlePrix.setAttribute("class", "article_prix");
      articleMail.setAttribute("class", "article_mail");
  
      /* Agencement des éléments index HTML */
      listeArticle.appendChild(articleContenant);
      articleContenant.appendChild(articleElement);
      articleElement.appendChild(articleNom);
      articleElement.appendChild(articleIllustration);
      articleIllustration.appendChild(articlePhoto);
      articleElement.appendChild(articlePrix);
      articleElement.appendChild(articleMail);
  
      /* Contenu des balises index HTML */
      articleNom.textContent = article.name;
      articlePrix.textContent = article.price + " €";
    });
  }





